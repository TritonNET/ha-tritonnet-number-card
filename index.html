<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TritonNet Card Test Harness</title>

    <script src="tritonnet-number-card.js"></script>

    <style>
        body {
            background-color: #121212; /* HA Dark Mode background */
            color: #e1e1e1;
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px;
        }

        h1 {
            margin-bottom: 20px;
            font-family: 'Orbitron', sans-serif;
            color: #00d2d3;
        }

        /* The Container for the Card - Resizable */
        #demo-container {
            border: 1px dashed #444;
            padding: 10px;
            width: 500px; /* Default Desktop width */
            max-width: 90%;
            transition: width 0.2s ease;
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
        }

        /* Controls Area */
        .controls {
            background: #1e1e1e;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #333;
            width: 100%;
            max-width: 600px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

            .control-group.full {
                grid-column: span 2;
            }

        label {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 5px;
            text-transform: uppercase;
            font-weight: bold;
        }

        input[type="text"], input[type="number"], select {
            background: #2b2b2b;
            border: 1px solid #444;
            color: #fff;
            padding: 8px;
            border-radius: 4px;
            font-size: 14px;
        }

        input[type="range"] {
            width: 100%;
            cursor: pointer;
        }

        .width-display {
            text-align: right;
            font-size: 12px;
            color: #00d2d3;
            margin-top: 5px;
        }
    </style>
</head>
<body>

    <h1>Card Test Harness</h1>

    <div id="demo-container">
    </div>

    <div class="controls">
        <div class="control-group full">
            <label>Card Width (Simulate Mobile/Desktop)</label>
            <input type="range" id="widthSlider" min="150" max="600" value="500">
            <div class="width-display" id="widthVal">500px</div>
        </div>

        <div class="control-group">
            <label>Theme Selection</label>
            <select id="themeInput">
                <option value="triton-hud">Triton HUD (Original)</option>
                <option value="minimal-dark" selected>Minimal Dark</option>
            </select>
        </div>

        <div class="control-group">
            <label>Icon</label>
            <input type="text" id="iconInput" value="mdi:flash">
        </div>

        <div class="control-group">
            <label>Sensor Value</label>
            <input type="text" id="valInput" value="184">
        </div>

        <div class="control-group">
            <label>Unit</label>
            <input type="text" id="unitInput" value="Wh">
        </div>

        <div class="control-group full">
            <label>Title</label>
            <input type="text" id="titleInput" value="Total Grid Export">
        </div>

        <div class="control-group full">
            <label>Description (Ignored in Minimal theme)</label>
            <input type="text" id="descInput" value="Main solar array active. Yield: {sensor.daily_yield} kWh.">
        </div>
    </div>

    <script>
        const container = document.getElementById('demo-container');
        // Create instance of the imported class
        const card = document.createElement('custom-ha-tritonnet-number-card');
        container.appendChild(card);

        // Inputs
        const widthSlider = document.getElementById('widthSlider');
        const widthVal = document.getElementById('widthVal');
        const valInput = document.getElementById('valInput');
        const unitInput = document.getElementById('unitInput');
        const titleInput = document.getElementById('titleInput');
        const descInput = document.getElementById('descInput');
        const themeInput = document.getElementById('themeInput');
        const iconInput = document.getElementById('iconInput');

        // Initial Config (Simulates YAML config)
        let config = {
            type: 'custom-ha-tritonnet-number-card',
            title: titleInput.value,
            description: descInput.value,
            number_entity: 'sensor.power_meter',
            theme: themeInput.value,
            icon: iconInput.value
        };
        card.setConfig(config);

        // Mock Hass Object Generator
        function updateCard() {
            // Update Config properties dynamically
            config.title = titleInput.value;
            config.description = descInput.value;
            config.theme = themeInput.value;
            config.icon = iconInput.value;
            card.setConfig(config);

            // Force the JS cache to clear so it re-renders immediately on changes
            card._lastValue = null;

            // Construct Mock Hass Object
            const mockHass = {
                states: {
                    'sensor.power_meter': {
                        state: valInput.value,
                        attributes: {
                            unit_of_measurement: unitInput.value
                        }
                    },
                    // Add mock data for template testing
                    'sensor.daily_yield': { state: '15.2' }
                }
            };

            // Push update to card
            card.hass = mockHass;
        }

        // --- Event Listeners ---

        // 1. Width Resizer
        widthSlider.addEventListener('input', (e) => {
            const w = e.target.value;
            container.style.width = w + 'px';
            widthVal.textContent = w + 'px';
        });

        // 2. Live Data Updates
        const inputs = [valInput, unitInput, titleInput, descInput, themeInput, iconInput];
        inputs.forEach(input => {
            input.addEventListener('input', updateCard);
            // Specifically add 'change' event for the <select> element so it fires immediately on click
            if (input.tagName === 'SELECT') {
                input.addEventListener('change', updateCard);
            }
        });

        // Initial Trigger
        updateCard();

    </script>
</body>
</html>